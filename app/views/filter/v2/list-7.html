{% extends "layout-extended.html" %}

{% block pageTitle %}
Referral list
{% endblock %}

{% block beforeContent %}
<a href="start" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}

<!-- <div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-l">
      New referrals
    </h1>
  </div>
</div> -->

<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-quarter">
    <h2 class="govuk-heading-m govuk-!-Marchgin-bottom-5">
      Filters
    </h2>
    <div id="filter-hint" class="govuk-hint govuk-!-Marchgin-bottom-4">
      Select one or more filters to apply to the list.
    </div>
    <div class="table-filter">
      <form id="filters">
        <!--Filters-->

        {{ govukCheckboxes({
        idPrefix: "caseType",
        name: "caseType",
        classes: "govuk-checkboxes--small",
        fieldset: {
        legend: {
        text: "Case type",
        isPageHeading: false,
        classes: "govuk-fieldset__legend--s"
        }
        },
        items: [
        {
        id: "srel",
        value: "srel",
        html: "Special rules for end of life (<span id='srelCount'>2</span>)"
        }
        ]
        }) }}

        {{ govukCheckboxes({
        idPrefix: "benefitType",
        name: "benefit-type",
        classes: "govuk-checkboxes--small",
        fieldset: {
        legend: {
        text: "Benefit type",
        isPageHeading: false,
        classes: "govuk-fieldset__legend--s"
        }
        },
        items: [
        {
        id: "esa",
        value: "esa",
        text: "Employment Support Allowance (13)"
        },
        {
        id: "pip",
        value: "pip",
        text: "Personal Independence Payment (25)"
        },
        {
        id: "uc",
        value: "uc",
        text: "Universal Credit (22)"
        }
        ]
        }) }}

        {{ govukCheckboxes({
        idPrefix: "assessmentCentre",
        name: "assessment-centre",
        classes: "govuk-checkboxes--small",
        fieldset: {
        legend: {
        text: "Assessment centre",
        isPageHeading: false,
        classes: "govuk-fieldset__legend--s"
        }
        },
        items: [
        {
        id: "handsworth",
        value: "handsworth",
        text: "Birmingham Handsworth (22)"
        },
        {
        id: "doncaster",
        value: "doncaster",
        text: "Doncaster site name (8)"
        },
        {
        id: "leeds",
        value: "leeds",
        text: "Leeds site name (10)"
        },
        {
        id: "tresco",
        value: "tresco",
        text: "London Tresco House (20)"
        }
        ]
        }) }}

        <button class="govuk-button govuk-button--secondary govuk-!-Marchgin-bottom-8">Apply filters</button>
      </form>



    </div>
  </div>
  <div class="govuk-grid-column-three-quarters">

    <h1 class="govuk-heading-l">
      Report ready referrals
    </h1>
    <p id="filter-playback" class="govuk-!-Marchgin-bottom-4">
      60 report ready referrals
    </p>

    <table class="govuk-table" data-module="moj-sortable-table">

      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
    
          <th scope="col" class="govuk-table__header" aria-sort="ascending">Name</th>
    
          <th scope="col" class="govuk-table__header" aria-sort="none">Elevation</th>
    
          <th scope="col" class="govuk-table__header" aria-sort="none">Continent</th>
    
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">First summit</th>
    
        </tr>
      </thead>
    
      <tbody class="govuk-table__body">
    
        <tr class="govuk-table__row">
    
          <td class="govuk-table__cell">Aconcagua</td>
    
          <td class="govuk-table__cell" data-sort-value="6961">6,961 meters</td>
    
          <td class="govuk-table__cell">South America</td>
    
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="1897">1897</td>
    
        </tr>
    
        <tr class="govuk-table__row">
    
          <td class="govuk-table__cell">Denali</td>
    
          <td class="govuk-table__cell" data-sort-value="6194">6,194 meters</td>
    
          <td class="govuk-table__cell">North America</td>
    
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="1913">1913</td>
    
        </tr>
    
        <tr class="govuk-table__row">
    
          <td class="govuk-table__cell">Elbrus</td>
    
          <td class="govuk-table__cell" data-sort-value="5642">5,642 meters</td>
    
          <td class="govuk-table__cell">Europe</td>
    
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="1874">1874</td>
    
        </tr>
    
        <tr class="govuk-table__row">
    
          <td class="govuk-table__cell">Everest</td>
    
          <td class="govuk-table__cell" data-sort-value="8850">8,850 meters</td>
    
          <td class="govuk-table__cell">Asia</td>
    
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="1953">1953</td>
    
        </tr>
    
        <tr class="govuk-table__row">
    
          <td class="govuk-table__cell">Kilimanjaro</td>
    
          <td class="govuk-table__cell" data-sort-value="5895">5,895 meters</td>
    
          <td class="govuk-table__cell">Africa</td>
    
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="1889">1889</td>
    
        </tr>
    
        <tr class="govuk-table__row">
    
          <td class="govuk-table__cell">Puncak Jaya</td>
    
          <td class="govuk-table__cell" data-sort-value="4884">4,884 meters</td>
    
          <td class="govuk-table__cell">Australia</td>
    
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="1962">1962</td>
    
        </tr>
    
        <tr class="govuk-table__row">
    
          <td class="govuk-table__cell">Vinson</td>
    
          <td class="govuk-table__cell" data-sort-value="4897">4,897 meters</td>
    
          <td class="govuk-table__cell">Antarctica</td>
    
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="1966">1966</td>
    
        </tr>
    
      </tbody>
    </table>
    

    <div class="pagination" id="pagination">
      <div class="pagination__summary">
        Showing 1 - 20 of <span id="paginationTotal">60</span> results
      </div>
      <nav class="govuk-pagination" role="navigation" aria-label="results">
        <ul class="govuk-pagination__list">
          <li class="govuk-pagination__item govuk-pagination__item--current">
            <a class="govuk-link govuk-pagination__link" href="#" aria-label="Page 1" aria-current="page">
              1
            </a>
          </li>
          <li class="govuk-pagination__item">
            <a class="govuk-link govuk-pagination__link" href="#" aria-label="Page 2">
              2
            </a>
          </li>
          <li class="govuk-pagination__item">
            <a class="govuk-link govuk-pagination__link" href="#" aria-label="Page 3">
              3
            </a>
          </li>
        </ul>
        <div class="govuk-pagination__next">
          <a class="govuk-link govuk-pagination__link" href="#" rel="next"> <span class="govuk-pagination__link-title">Next</span> <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
              <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path>
            </svg></a>
        </div>
      </nav>
    </div>


  </div>
</div>

<script>

  function hideAllWithClass(classname) {
    document.querySelectorAll("." + classname).forEach((element) => {
      element.style.visibility = 'collapse';
    });
  }

  function showAllWithClass(classname) {
    document.querySelectorAll("." + classname).forEach((element) => {
      element.style.visibility = 'visible';
    });
  }

  document.querySelector("#filters").addEventListener("submit", function (e) {

    e.preventDefault();    //stop form from submitting

    showAllWithClass("esa");
    showAllWithClass("pip");
    showAllWithClass("uc");
    showAllWithClass("tresco");
    showAllWithClass("handsworth");
    showAllWithClass("srel");
    showAllWithClass("no-srel");

    let benefitTypes = [];
    let sites = [];

    if (document.getElementById('srel').checked == true) {
      hideAllWithClass("no-srel");
    }

    if (document.getElementById('pip').checked == true || document.getElementById('esa').checked == true || document.getElementById('uc').checked == true) {
      if (document.getElementById('pip').checked == false) {
        hideAllWithClass("pip");
      } else {
        benefitTypes.push("Personal Independence Payment");
      }

      if (document.getElementById('esa').checked == false) {
        hideAllWithClass("esa");
      } else {
        benefitTypes.push("Employment Support Allowance");
      }

      if (document.getElementById('uc').checked == false) {
        hideAllWithClass("uc");
      } else {
        benefitTypes.push("Universal Credit");
      }
    }

    if (document.getElementById('handsworth').checked == true || document.getElementById('tresco').checked == true) {
      if (document.getElementById('handsworth').checked == false) {
        hideAllWithClass("handsworth");
      } else {
        sites.push("Handsworth");
      }

      if (document.getElementById('tresco').checked == false) {
        hideAllWithClass("tresco");
      } else {
        sites.push('Tresco');
      }
    }

    var count = 0;
    var elemnts = document
      .querySelectorAll('.govuk-table tr').forEach((element) => {
        if (element.style.visibility === 'visible') {
          count += 1;
        }
      })

    if (count < 20) {
      document.getElementById('pagination').style.visibility = 'collapse';
    } else {
      document.getElementById('pagination').style.visibility = 'visible';
    }

    document.getElementById('paginationTotal').innerText = count;

    var eol = document.getElementById('srel').checked ? " end of life" : "";
    var benefitTypeString = benefitTypes.join(", ");
    var sitesString = sites.join(", ");
    var ifBenefitType = benefitTypes.length > 0 ? ' for ' : '';
    var ifSites = sites.length > 0 ? ' at ' : '';

    //11 HCP review end of life referrals in PIP, ESA, UC at Birmingham Handsworth
    var text = count + " report ready " + eol + " referrals " + ifBenefitType + benefitTypeString + ifSites + sitesString;

    document.getElementById('filter-playback').innerText = text;

    // document.getElementById('srelCount').innertext = document.querySelectorAll('.govuk-table tr.srel').length;

  });

</script>

{% endblock %}
